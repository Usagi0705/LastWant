@model IEnumerable<prjCoreWebWantWant.Models.TaskList>
@*@model IEnumerable<WantTask.ViewModels.CTaskListDetailItem>*@
@*@model List<TaskList>*@

@{
    ViewData["Title"] = "TablesEditable";
    Layout = "~/Views/Member/LayoutForMem.cshtml";
}

<head>

    <link href="~/backstage1/static/css/dataTables.bootstrap4.min.css" rel="stylesheet" type="text/css">

    <!-- preloader css -->
    <link rel="stylesheet" href="~/backstage1/static/css/preloader.min.css" type="text/css">

    <!-- Bootstrap Css -->
    @* <link href="~/backstage1/static/css/bootstrap.min.css" id="bootstrap-style" rel="stylesheet" type="text/css"> *@

    <!-- Icons Css -->
    <link href="~/backstage1/static/css/icons.min.css" rel="stylesheet" type="text/css">

    <!-- App Css-->
    <link href="~/backstage1/static/css/app.min.css" id="app-style" rel="stylesheet" type="text/css">

    <!-- JobdetailBackstage css -->
    <!-- glightbox css -->
    <link rel="stylesheet" href="~/backstage1/static/css/glightbox.min.css">

   
    <style>

        .table-hover tbody tr:hover {
            background-color: #f5f5f5; /* 或者你想要的其他背景顏色 */
        }

        .btn-outline-secondary:hover {
            background-color: #528EAF; /* 更改滑鼠滑過的背景顏色 */
            border-color: #528EAF; /* 更改滑鼠滑過的邊框顏色 */
            color: #fff; /* 更改滑鼠滑過的文字顏色 */
        }
    </style>
</head>




<body>

        <div id="layout-wrapper">
          
          @*   <div class="main-content">*@
               @*  <div class="page-content"> *@
                    <div class="container-fluid">

         @*   <nav aria-label="breadcrumb">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item"><a href="#">會員專區</a></li>
                    <li class="breadcrumb-item"><a href="#">找人力</a></li>
                    <li class="breadcrumb-item active" aria-current="page">發案紀錄</li>
                </ol>
            </nav>*@

                     
                        <div class="row">
                            <div class="col-12">
                                <div class="page-title-box d-sm-flex align-items-center justify-content-between"> 
                                </div>
                            </div>
                        </div>
                    
                        <!--已上架未上架 任務類型 關鍵字-->
                        <div class="row">
                            <div class="col-12">
                                <div class="card">
                                    <div class="card-header">

                                        <div class="row">
                                            <div class="card-body col-4">
                                             
                                                <!--已上架 未上架-->
                                                <ul class="nav nav-tabs nav-tabs-custom nav-justified" role="tablist">
                                                    <li class="nav-item" onclick="showPublish();">
                                                        <a class="nav-link active" data-bs-toggle="tab" href="#Publish" role="tab">
                                                            <span class="d-block d-sm-none"><i class="fas fa-home"></i></span>
                                                            <span class="d-none d-sm-block" style="color:#528EAF" id="publish">已上架</span>
                                                        </a>
                                                    </li>
                                                    <li class="nav-item" onclick="showNoPublish();">
                                                        <a class="nav-link" data-bs-toggle="tab" href="#NoPublish" role="tab">
                                                            <span class="d-block d-sm-none"><i class="far fa-user"></i></span>
                                                           <span class="d-none d-sm-block" style="color:#528EAF" id="Nopublish">未上架</span>
                                                        </a>
                                                    </li>
                                                </ul>
                                            </div>
                                            <!--標籤  選擇任務類型-->

                                            <!--已上架的標籤-->
                                            <div class="col-4 mb-3" id="PublishSelect">
                                                <form class="app-search d-none d-lg-block">
                                                    @{
                                                        NewIspanProjectContext _context = new NewIspanProjectContext();
                                                        var q = from p in _context.TaskNameLists
                                                                select p.TaskName;
                                                    }

                                                    <select class="form-select" id="selTaskNamePublish">
                                                        <option value="">請選擇任務類型</option>
                                                        @foreach (var item in q)
                                                        {
                                                            <option name="category">@item</option>
                                                        }
                                                    </select>
                                                </form>
                                            </div>

                                            <!--未上架的標籤-->
                                            <div class="col-4 mb-3" style="display:none" id="NoPublishSelect">
                                                <form class="app-search d-none d-lg-block">
                                                    @{
                                                        NewIspanProjectContext _context2 = new NewIspanProjectContext();
                                                        var qq = from p in _context2.TaskNameLists
                                                                 select p.TaskName;

                                                    }

                                                    <select class="form-select" id="selTaskNameNoPublish">
                                                        <option value="">請選擇任務類型</option>
                                                        @foreach (var item in qq)
                                                        {
                                                            <option name="category">@item</option>
                                                        }
                                                    </select>
                                                </form>
                                            </div>

                                            <!--關鍵字搜尋-->                               

                                            <div class="col-4 mb-3">
                                                <form class="app-search d-none d-lg-block">
                                                    <div class="position-relative">
                                                        <input type="text" class="form-control" placeholder="請輸入關鍵字" name="keyword">
                                                        <button class="btn btn-primary" type="submit" style="background-color:#528EAF"><i class="bx bx-search-alt align-middle"></i></button>
                                                    </div>
                                                </form>
                                                </div>
                                        </div>
                                    </div>

                                    <!--已上架-->
                                   <div class="card-body" id="Publish">
                            <table class="table table-hover table align-middle datatable dt-responsive table-check nowrap" style="border-collapse: collapse; border-spacing: 0 8px; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">序號</th>
                                        <th style="width: 150px;">任務名稱</th>
                                        <th style="width: 300px;">任務內容</th>
                                        <th style="width: 100px;">任務日期</th>
                                        @*<th style="width: 50px;">更改狀態</th>*@
                                        <th style="width: 50px;">修改</th>
                                    </tr>
                                </thead>

                                <tbody>

                                    @{
                                        if (Model != null)
                                        {
                                            int count1 = 0;

                                        foreach (var item in Model)
                                        {                                            
                                            int maxDisplayLength = 10; // 設定要顯示的最大字數
                                            string taskDetail = item.TaskDetail  ;

                                            if (taskDetail.Length > maxDisplayLength)
                                            {
                                                taskDetail = taskDetail.Substring(0, maxDisplayLength) + " ..."; // 截斷字串
                                            }

                                            count1++;
                                            <tr data-id="1">
                                                <td data-field="id" style="width: 80px">@count1</td>
                                                <td data-field="name">@Html.DisplayFor(modelItem => item.TaskTitle)</td>
                                                <td data-field="age">@Html.DisplayFor(modelItem => taskDetail)</td>
                                                <td data-field="gender">@Html.DisplayFor(modelItem => item.TaskStartDate)</td>
                                                @*<td data-field="gender">@Html.DisplayFor(modelItem => item.PublishOrNot)</td>*@
                                                <td style="width: 100px">
                                                        @*<a class="btn btn-outline-secondary btn-sm edit" title="Edit" href="@Html.ActionLink("修改"  , "Edit", new { CaseID = item.CaseId })">   </a>*@
                                                        @*@Html.ActionLink("修改","Edit",new {id = item.CaseId})  *@

                                                        @*@Html.ActionLink("修改","Edit",new {id = item.CaseId})*@
                                                        @*<a class="btn btn-outline-secondary btn-sm edit" title="Edit" href="#" data-bs-toggle="modal" data-bs-target="#myModal_@item.CaseId">*@
                                                            @*<i class="fas fa-pencil-alt"></i>*@

                                                        @*<a href="@Url.Action("Edit", new { id = item.CaseId })">
                                                            <i class="fas fa-pencil-alt" data-id="@item.CaseId"></i>
                                                        </a>*@

                                                        <a href="@Url.Content("~/BackstageTask/Edit")?id=@item.CaseId" >
                                                            <i class="fas fa-pencil-alt"></i>
                                                        </a>

                                                        @Html.ActionLink("下架", "NoPublish","BackstageTask", new {id=item.CaseId}, new { @class = "btn btn-outline-secondary" ,style="color:#528EAF"})
                                                        @Html.ActionLink("上架", "Publish","BackstageTask", new {id=item.CaseId}, new { @class = "btn btn-outline-secondary" ,style="color:#528EAF"})
                                                </td>
                                            </tr>


                                            @*modal*@

                                            <div class="modal" tabindex="-1" id="myModal_@item.CaseId" style="display:none">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">修改任務內容</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                            <input type="hidden" id="modalCaseId" value="@item.CaseId">
                                                        </div>
                                                        <div class="modal-body">
                                                            @*修改任務內容*@
                                                            <div class="col">
                                                                <div class="mb-3">
                                                                    <label for="exampleFormControlInput1" class="form-label">任務標題</label>
                                                                    <input type="text" class="form-control" id="TaskTitle" value="@Html.DisplayFor(modelItem => item.TaskTitle)">
                                                                </div>
                                                                <p class="card-text">
                                                                    <div class="mb-3">
                                                                        <label for="exampleFormControlTextarea1" class="form-label">任務內容</label>
                                                                        <textarea class="form-control" id="TaskDetail" rows="3">@Html.DisplayFor(modelItem => item.TaskDetail)</textarea>
                                                                    </div>

                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                                                        <label class="form-check-label" for="flexCheckDefault">
                                                                            下架此任務
                                                                        </label>
                                                                    </div>

                                                                </p>

                                                                <div class="card-footer text-center">
                                                                    <form action="@Url.Content("~/BackstageTask/TablesEditable")" method="post" style="justify-content: center ; align-items: center ">
                                                                        <input onclick="Alert()"
                                                                               id="saveBtn"
                                                                               class="btn btn-primary"
                                                                               style="background-color: #528EAF"
                                                                               type="submit"
                                                                               value="送出"
                                                                               a href="@Url.Content("~/BackstageTask/UpdateTask")" />
                                                                    </form>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        }
                                    }
                                    }
                                </tbody>

                            </table>

                                    </div>

                                    <!--未上架-->
                      <div class="card-body" style="display:none" id="NoPublish">
                            <table class="table table-hover table align-middle datatable dt-responsive table-check nowrap" style="border-collapse: collapse; border-spacing: 0 8px; width: 100%;">
                                <thead>
                                    <tr>
                                        <th style="width: 50px;">序號</th>
                                        <th style="width: 150px;">任務名稱</th>
                                        <th style="width: 300px;">任務內容</th>
                                        <th style="width: 100px;">任務日期</th>
                                        @* <th style ="width: 50px;">更改狀態</th>*@
                                        <th style="width: 50px;">修改</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    @{

                                        NewIspanProjectContext db = new NewIspanProjectContext();
                                        var q2 = from t in db.TaskLists
                                                 join tt in db.TaskNameLists on t.TaskNameId equals tt.TaskNameId
                                                 where t.PublishOrNot == "延後上架" && t.TaskNameId == tt.TaskNameId
                                                 select t;

                                        int count2 = 0;

                                        foreach (var item in q2)
                                        {
                                            int maxDisplayLength = 10; // 設定要顯示的最大字數
                                            string taskDetail = item.TaskDetail;

                                            if (taskDetail.Length > maxDisplayLength)
                                            {
                                                taskDetail = taskDetail.Substring(0, maxDisplayLength) + " ..."; // 截斷字串
                                            }
                                            count2++;

                                            <tr data-id="1">
                                                <td data-field="id" style="width: 80px">@count2</td>
                                                <td data-field="name">@Html.DisplayFor(modelItem => item.TaskTitle)</td>
                                                <td data-field="age">@Html.DisplayFor(modelItem => taskDetail)</td>
                                                <td data-field="gender">@Html.DisplayFor(modelItem => item.TaskStartDate)</td>
                                                @*<td data-field="gender">@Html.DisplayFor(modelItem => item.PublishOrNot)</td>*@
                                                <td style="width: 100px">
                                                    @*<a class="btn btn-outline-secondary btn-sm edit" title="Edit" href="@Url.Content("~/backstagetask/JobdetailBackstage")">*@
                                                    <a class="btn btn-outline-secondary btn-sm edit" title="Edit" href="#" data-bs-toggle="modal" data-bs-target="#myModal_@item.CaseId">
                                                        <i class="fas fa-pencil-alt"></i>
                                                    </a>
                                                </td>
                                            </tr>

                                            <div class="modal" tabindex="-1" id="myModal_@item.CaseId">
                                                <div class="modal-dialog">
                                                    <div class="modal-content">
                                                        <div class="modal-header">
                                                            <h5 class="modal-title">修改任務內容</h5>
                                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                                        </div>
                                                        <div class="modal-body">
                                                            @*修改任務內容*@
                                                            <div class="col">
                                                                <div class="mb-3">
                                                                    <label for="exampleFormControlInput1" class="form-label">任務標題</label>
                                                                    <input type="text" class="form-control" id="exampleFormControlInput1" value="@Html.DisplayFor(modelItem => item.TaskTitle)">
                                                                </div>
                                                                <p class="card-text">
                                                                    <div class="mb-3">
                                                                        <label for="exampleFormControlTextarea1" class="form-label">任務內容</label>
                                                                        <textarea class="form-control" id="exampleFormControlTextarea1" rows="3">@Html.DisplayFor(modelItem => item.TaskDetail)</textarea>
                                                                    </div>

                                                                    <div class="form-check">
                                                                        <input class="form-check-input" type="checkbox" value="" id="flexCheckDefault">
                                                                        <label class="form-check-label" for="flexCheckDefault">
                                                                            上架此任務
                                                                        </label>
                                                                    </div>

                                                                </p>

                                                                <div class="card-footer text-center">
                                                                    <form action="@Url.Content("~/BackstageTask/TablesEditable")" method="post" style="justify-content: center ; align-items: center ">
                                                                        <input onclick="Alert()"
                                                                               class="btn btn-primary"
                                                                               style="background-color: #528EAF"
                                                                               type="submit"
                                                                               value="送出" />
                                                                    </form>
                                                                </div>

                                                            </div>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                        }

                                    }
                                </tbody>
                            </table>

                                    </div>

                                    <!--點選tab切換表格-->
                                    <script>
                                        function showPublish() {
                                            //先取得要操作的標籤
                                            let Publish = document.querySelector("#Publish");
                                            let NoPublish = document.querySelector("#NoPublish");
                                            let PublishSelect = document.querySelector("#PublishSelect");
                                            let NoPublishSelect = document.querySelector("#NoPublishSelect");

                                            //再對標籤做操作
                                            Publish.style.display = "block";
                                            NoPublish.style.display = "none";
                                            PublishSelect.style.display = "block";
                                            NoPublishSelect.style.display = "none";
                                        }

                                        function showNoPublish() {
                                            //先取得要操作的標籤
                                            let Publish = document.querySelector("#Publish");
                                            let NoPublish = document.querySelector("#NoPublish");
                                            let PublishSelect = document.querySelector("#PublishSelect");
                                            let NoPublishSelect = document.querySelector("#NoPublishSelect");

                                            //再對標籤做操作
                                            Publish.style.display = "none";
                                            NoPublish.style.display = "block";
                                            PublishSelect.style.display = "none";
                                            NoPublishSelect.style.display = "block";
                                        }
                                    </script>


                                </div>
                            </div>
                        </div>
                       

                    </div> 
              @*   </div> *@
               
            @* </div> *@
            
        </div>
     


@section Scripts{
    <script>
                     
        const selTaskNamePublish = document.querySelector('#selTaskNamePublish');

        selTaskNamePublish.addEventListener('change', () => {

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Content("~/BackstageTask/PartialPublish")');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(`category=${selTaskNamePublish.value}`);
            xhr.addEventListener('load', () => {
                const Publish = document.querySelector('#Publish')
                Publish.innerHTML = xhr.responseText;
            })
        })

        const selTaskNameNoPublish = document.querySelector('#selTaskNameNoPublish');

        selTaskNameNoPublish.addEventListener('change', () => {

            const xhr = new XMLHttpRequest();
            xhr.open('POST', '@Url.Content("~/BackstageTask/PartialNoPublish")');
            xhr.setRequestHeader('Content-Type', 'application/x-www-form-urlencoded');
            xhr.send(`category=${selTaskNameNoPublish.value}`);
            xhr.addEventListener('load', () => {
                const NoPublish = document.querySelector('#NoPublish')
                NoPublish.innerHTML = xhr.responseText;
            })
        })

            const publish = document.querySelector('#publish');
            const Nopublish = document.querySelector('#Nopublish');

            function showPublish() {
                publish.style.color = 'red';
                Nopublish.style.color = ''; // 將未上架標籤的顏色還原
            }

            function showNoPublish() {
                publish.style.color = ''; // 將已上架標籤的顏色還原
                Nopublish.style.color = 'red';
            }

    </script>
}




    @* <script src="~/backstage1/lib/jquery/dist/jquery.min.js"></script>
    <script src="~/backstage1/lib/bootstrap/dist/js/bootstrap.bundle.min.js"></script>
    <script src="~/backstage1/js/site.js" asp-append-version="true"></script>
 *@


    <!--Approve js-->


    <!--JAVASCRIPT-- >
       <script src="~/backstage1/static/js/jquery.min.js" ></script>
       <script src="~/backstage1/static/js/bootstrap.bundle.min.js"></script>
       <script src="~/backstage1/static/js/metisMenu.min.js"></script>
       <script src="~/backstage1/static/js/simplebar.min.js"></script>
       <script src="~/backstage1/static/js/waves.min.js"></script>
       <script src="~/backstage1/static/js/feather.min.js"></script>
 

       <!-- Required datatable js -->
    <script src="~/backstage1/static/js/jquery.dataTables.min.js"></script>

    <!-- Responsive examples -->
    <script src="~/backstage1/static/js/dataTables.responsive.min.js"></script>
    <script src="~/backstage1/static/js/responsive.bootstrap4.min.js"></script>

    <!-- init js show 10 頁   previous next -->
    <script src="~/backstage1/static/js/datatable-pages.init.js"></script>
    <script src="~/backstage1/static/js/dataTables.bootstrap4.min.js"></script>


    <!-- Table Editable plugin -->
    <script src="~/backstage1/static/js/table-edits.min.js"></script>
    <script src="~/backstage1/static/js/table-editable.int.js"></script>
    <script src="~/backstage1/static/js/app.js"></script>

    <!-- JobdetailBackstage js -->
    <!-- glightbox js -->
    <script src="~/backstage1/static/js/glightbox.min.js"></script>

    <!-- lightbox init -->
    <script src="~/backstage1/static/js/lightbox.init.js"></script>


</body>
</html>

@section subTitle{


    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">會員專區</li>
            <li class="breadcrumb-item">找人才</li>
            <li class="breadcrumb-item " aria-current="page">發案紀錄</li>
        </ol>
    </nav>
}

   

