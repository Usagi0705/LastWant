@model IEnumerable<prjCoreWebWantWant.Models.Order>
@{
    //ViewData["Title"] = "Order";
    Layout = "~/Views/Member/LayoutForMem.cshtml";
}

@section subTitle{


    <nav aria-label="breadcrumb">
        <ol class="breadcrumb">
            <li class="breadcrumb-item">會員專區</li>
            <li class="breadcrumb-item">商城</li>
            <li class="breadcrumb-item " aria-current="page">曝光紀錄</li>
        </ol>
    </nav>
}
<div class="header-container">
    <h2>進行中的曝光</h2>
</div>

<div class="container mt-4">
    <table id="table" class="table table-striped mt-5">
        <thead align="center">
            <tr>
                <th></th>
                <th>案件名稱</th>
                <th>曝光類型</th>
                <th>截止日</th>
                <th>倒數<i class='bx bx-time bx-tada'></i></th>
            </tr>
        </thead>
        <tbody align="center">
            @{
                var displayedTitles = new Dictionary<string, bool>(); // 用于存储已经显示过的标题
            }

            @foreach (var order in Model)
            {
                foreach (var item in order.OrderDetails)
                {
                    string title = "";
                    bool isCase = false;

                    if (item.CaseId != null)
                    {
                        title = item.Case.TaskTitle;
                        isCase = true;
                    }
                    else if (item.ResumeId != null)
                    {
                        title = item.Resume.ResumeTitle;
                    }

                    if (!displayedTitles.ContainsKey(title))
                    {
                        displayedTitles.Add(title, true);

                        <tr>
                            <td><i class='bx bxs-hot bx-tada' style="color: crimson"></i></td>
                            <td>@title</td>
                            <td>@item.TopType</td>
                            <td>@(isCase ? item.Case.OnTop : item.Resume.OnTop)</td>
                            <td><span></span></td>
                            <td></td>
                        </tr>
                    }
                }
            }
        </tbody>



</table>
  </div>

<hr />
<br />

<div class="header-container">
    <h2>訂單紀錄</h2>
</div>
<div class="container mt-4">
    <div class="row align-items-center">


        <div class="row mt-3">
            <div class="d-flex">
                <button type="button" class="btn btn-outline-primary">全部訂單</button>
                <button type="button" class="btn btn-outline-primary">履歷訂單</button>
                <button type="button" class="btn btn-outline-primary">任務訂單</button>
                <button type="button" class="btn btn-outline-primary">今日訂單</button>
                <button type="button" class="btn btn-outline-primary">過去7天</button>
                <button type="button" class="btn btn-outline-primary">過去31天</button>

            </div>
        </div>

    </div>
   
    <table id="table" class="table table-striped mt-5">
        <thead align="center">
            <tr>
                <td></td>
                <td>訂單編號</td>
                <td>日期</td>
                <td>名稱</td>
                <td>類別</td>
                <td>回饋紅利</td>     
                <td>商品金額</td>
                <td>使用紅利</td>
                <td>訂單金額</td>


            </tr>
        </thead>
        <tbody align="center">
            @foreach (var order in Model)
            {
            
                <tr>
                    
                <td>
                            <a data-bs-toggle="collapse" data-bs-target="#orderDetails_@(order.OrderId)" class="accordion-toggle">
                        <i class="bx bxs-show"></i>
                    </a>
                </td>
                        <td>@order.OrderId</td>
                <td>@order.CreateTime</td> 
                    <td>
                        @if (order.OrderDetails.Any())
                        {
                            var firstOrderDetail = order.OrderDetails.First();
                            @if (firstOrderDetail.CaseId != null)
                            {
                                <span>@firstOrderDetail.Case.TaskTitle</span>
                            }
                            else if (firstOrderDetail.ResumeId != null)
                            {
                                <span>@firstOrderDetail.Resume.ResumeTitle</span>
                            }
                        }
                    </td>
                        <td>@order.Category.CategoryName</td>
                <td>@order.OrderGetPoint</td>
                <td>@order.OrderPrice</td>
                        <td>@order.OrderUsePoint</td>
                        <td>@order.PaidAmount</td>
            </tr>
            <!-- 可展開/收起的內容 -->
            <tr>
                        <td colspan="12" class="hiddenRow">
                            <div class="collapse" id="orderDetails_@(order.OrderId)" data-bs-parent="#table">
                                <!-- 在這裡填入訂單明細內容 -->
                                <table class="table table-bordered">
                                    <thead class="table-dark">
                                       
                                <tr>
                                    <th>商品名稱</th>
                                    <th>數量</th>
                                    <th>單價</th>
                                    <th>小計</th>
                                </tr>
                            </thead>
                            <tbody>
                                        @foreach (var detail in order.OrderDetails)
                                        {
                                <tr>
                                    <td>@detail.Product.ProductName</td>
                                    <td>@detail.Quantity</td>
                                    <td>@detail.UnitPrice</td>
                                    <td>@(detail.UnitPrice * detail.Quantity)</td>
                                </tr>
                                        }
                            </tbody>
                        </table>
                    </div>
                </td>
            </tr>
            
            }
        </tbody>
    </table>
</div>

@section Styles {
    <!--box icons-->
    <link href='https://unpkg.com/boxicons@2.1.4/css/boxicons.min.css' rel='stylesheet'>
    <style>
        /* 將外層容器設置為相對定位 */
        .header-container {
            position: relative;
        }

      

        .bx {
            font-size: 1.5rem;
        }
    </style>
}

@section Scripts
{
    
}
